Создание node:
Создание и инициализация структуры
Спинлок(nodes_lock);
RCU-добавление node в хеш-таблицу
Спин-анлок;

Удаление node:
rcu_read_lock();
поиск ноды
Установка флага удаления ноды//TODO: Все остальные процессы должны будут удалить после synchronize_rcu
rcu_read_unlock()
synchronize_rcu()
Если счетчик == 0
	Удалить структуру node

//Снизу под подписчиком подразумевается издатель
Добавление подписчиков:
Создание структуры подписчика
rcu_read_lock();
поиск ноды
увеличение счетчика использования
rcu_read_unlock();
rcu_read_lock();
Поиск pub
Установка флага, найден pub или нет
rcu_read_unlock();
Если флаг установлен:
	спинлок(pub_lock);
	добавить pub
	спинанлок(pub_lock);
Иначе
	Удалить структуру pub
Уменьшение счётчика
//TODO:Надо просмотреть последовательность действий, что в начале - синхронизация rcu или уменьшение и проверка счетчиков
synchronize_rcu
Если установлен флаг удаления
	Удалить node

Удаление подписчика:
rcu_read_lock();
Поиск ноды
Увеличение счетчика использования
rcu_read_unlock();
rcu_read_lock();
Поиск pub
Установка флага, найден pub или нет
rcu_read_unlock();
Если паб найден:
	спинлок(pub_lock);
	удалить pub
	спинанлок(pub_lock);
Уменьшение счётчика
//TODO:Надо просмотреть последовательность действий, что в начале - синхронизация rcu или уменьшение и проверка счетчиков
synchronize_rcu
Если установлен флаг удаления
	Удалить node
Если паб найден:
	Удалить pub из памяти

Отправка сообщения:
rcu_read_lock();
Поиск ноды
Увеличение счетчика использования
rcu_read_unlock();
rcu_read_lock();
Поиск паба
Установка флага, если паб найден
rcu_read_unlock();
Отправить новое сообщение
Уменьшение счётчика
//TODO: Удалить если установлен флаг и счетчик = 0

__Отправка сообщения:
Спин-лок(буфер)
1)Получить свободный номер сообщения
2)Занять адрес сообщения
Спин-анлок(буфер)

Подписка:
Создание структуры подписчика
Создание структуры позиции
rcu_read_lock();
Поиск ноды
Увеличение счетчика использования
rcu_read_unlock();
rcu_read_lock();
Поиск sub
Установка флага, найден sub или нет
rcu_read_unlock();
Если sub не найден
	спинлок()
	добавить новый sub (RCU)
	добавить новый pos (Подумай)
	спинанлок();
Далее как обычно
Если sub уже найден, то удалить новые структуры

Отписка:
rcu_read_lock();
Поиск ноды
Увеличение счетчика использования
rcu_read_unlock();
rcu_read_lock();
Поиск sub
Установка флага, найден sub или нет
rcu_read_unlock();
Если sub найден
	спинлок()
	удалить подписчика
	удалить привязанную точку
	спин-анлок()
Далее удаление структур, проверка на удаление и, если верно, удаление ноды.


Получение сообщений:
rcu_read_lock();
Поиск ноды
Увеличение счетчика использования
rcu_read_unlock();
rcu_read_lock();
Поиск sub
Установка флага, найден sub или нет
rcu_read_unlock();

Если подписчик найден:
	чтение сообщение из буфера
Потом как обычно, уменьшение счётчика, сравнение с нулем и удаление ноды

