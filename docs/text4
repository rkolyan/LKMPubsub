Итак, у меня встряла проблема: Я не могу использовать блокирование (то есть какое-нибудь synchronize_rcu, к примеру) потому что kretprobe выполняет перехватываемую функцию в атомарном контексте
Решения:
1)Заменить где возможно synchronize_rcu на call_rcu с отложенной функцией (например, для удаления структур)
2)Написать явный ассеблерный переход в месте, где sys_ni_syscall вызывается
3)Посмотреть, что можно сделать с kretprobe (например, что может означать max_active = 10)

3 - не работает
1 - может и сработает с отложенным удалением, но не сработает в ожидании, пока с нодой работают процессы (к тому же я так понял kretprobe делает всё в контексте прерывания)

Вариант решения проблемы с kretprobe:
Везде заменить synchronize_rcu на call_rcu,
Например, при удалении position, subscriber, publisher
Ситуация при удалении node


Как вариант:
1)Найти при помощи kprobe адрес функции __x64_sys_ni_syscall
2)Определить смещение при помощи jmp
2)Записать туда jmp (адрес обработчика)
